{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _IsolatedWorld_instances, _a, _IsolatedWorld_frame, _IsolatedWorld_document, _IsolatedWorld_context, _IsolatedWorld_detached, _IsolatedWorld_ctxBindings, _IsolatedWorld_boundFunctions, _IsolatedWorld_taskManager, _IsolatedWorld_puppeteerUtil, _IsolatedWorld_bindingIdentifier, _IsolatedWorld_client_get, _IsolatedWorld_frameManager_get, _IsolatedWorld_timeoutSettings_get, _IsolatedWorld_injectPuppeteerUtil, _IsolatedWorld_settingUpBinding, _IsolatedWorld_onBindingCalled;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.IsolatedWorld = exports.PUPPETEER_WORLD = exports.MAIN_WORLD = void 0;\nconst injected_js_1 = require(\"../generated/injected.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst DeferredPromise_js_1 = require(\"../util/DeferredPromise.js\");\nconst ErrorLike_js_1 = require(\"../util/ErrorLike.js\");\nconst LazyArg_js_1 = require(\"./LazyArg.js\");\nconst LifecycleWatcher_js_1 = require(\"./LifecycleWatcher.js\");\nconst util_js_1 = require(\"./util.js\");\nconst WaitTask_js_1 = require(\"./WaitTask.js\");\n/**\n * A unique key for {@link IsolatedWorldChart} to denote the default world.\n * Execution contexts are automatically created in the default world.\n *\n * @internal\n */\nexports.MAIN_WORLD = Symbol('mainWorld');\n/**\n * A unique key for {@link IsolatedWorldChart} to denote the puppeteer world.\n * This world contains all puppeteer-internal bindings/code.\n *\n * @internal\n */\nexports.PUPPETEER_WORLD = Symbol('puppeteerWorld');\n/**\n * @internal\n */\nclass IsolatedWorld {\n  constructor(frame) {\n    _IsolatedWorld_instances.add(this);\n    _IsolatedWorld_frame.set(this, void 0);\n    _IsolatedWorld_document.set(this, void 0);\n    _IsolatedWorld_context.set(this, (0, DeferredPromise_js_1.createDeferredPromise)());\n    _IsolatedWorld_detached.set(this, false);\n    // Set of bindings that have been registered in the current context.\n    _IsolatedWorld_ctxBindings.set(this, new Set());\n    // Contains mapping from functions that should be bound to Puppeteer functions.\n    _IsolatedWorld_boundFunctions.set(this, new Map());\n    _IsolatedWorld_taskManager.set(this, new WaitTask_js_1.TaskManager());\n    _IsolatedWorld_puppeteerUtil.set(this, (0, DeferredPromise_js_1.createDeferredPromise)());\n    // If multiple waitFor are set up asynchronously, we need to wait for the\n    // first one to set up the binding in the page before running the others.\n    _IsolatedWorld_settingUpBinding.set(this, null);\n    _IsolatedWorld_onBindingCalled.set(this, async event => {\n      let payload;\n      if (!this.hasContext()) {\n        return;\n      }\n      const context = await this.executionContext();\n      try {\n        payload = JSON.parse(event.payload);\n      } catch {\n        // The binding was either called by something in the page or it was\n        // called before our wrapper was initialized.\n        return;\n      }\n      const {\n        type,\n        name,\n        seq,\n        args\n      } = payload;\n      if (type !== 'internal' || !__classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").has(__classPrivateFieldGet(IsolatedWorld, _a, \"f\", _IsolatedWorld_bindingIdentifier).call(IsolatedWorld, name, context._contextId))) {\n        return;\n      }\n      if (context._contextId !== event.executionContextId) {\n        return;\n      }\n      try {\n        const fn = this._boundFunctions.get(name);\n        if (!fn) {\n          throw new Error(`Bound function $name is not found`);\n        }\n        const result = await fn(...args);\n        await context.evaluate((name, seq, result) => {\n          // @ts-expect-error Code is evaluated in a different context.\n          const callbacks = self[name].callbacks;\n          callbacks.get(seq).resolve(result);\n          callbacks.delete(seq);\n        }, name, seq, result);\n      } catch (error) {\n        // The WaitTask may already have been resolved by timing out, or the\n        // exection context may have been destroyed.\n        // In both caes, the promises above are rejected with a protocol error.\n        // We can safely ignores these, as the WaitTask is re-installed in\n        // the next execution context if needed.\n        if (error.message.includes('Protocol error')) {\n          return;\n        }\n        (0, util_js_1.debugError)(error);\n      }\n    });\n    // Keep own reference to client because it might differ from the FrameManager's\n    // client for OOP iframes.\n    __classPrivateFieldSet(this, _IsolatedWorld_frame, frame, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).on('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n  }\n  get puppeteerUtil() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_puppeteerUtil, \"f\");\n  }\n  get taskManager() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\");\n  }\n  get _boundFunctions() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_boundFunctions, \"f\");\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\");\n  }\n  clearContext() {\n    __classPrivateFieldSet(this, _IsolatedWorld_document, undefined, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_puppeteerUtil, (0, DeferredPromise_js_1.createDeferredPromise)(), \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_context, (0, DeferredPromise_js_1.createDeferredPromise)(), \"f\");\n  }\n  setContext(context) {\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"m\", _IsolatedWorld_injectPuppeteerUtil).call(this, context);\n    __classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").clear();\n    __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolve(context);\n  }\n  hasContext() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolved();\n  }\n  _detach() {\n    __classPrivateFieldSet(this, _IsolatedWorld_detached, true, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).off('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").terminateAll(new Error('waitForFunction failed: frame got detached.'));\n  }\n  executionContext() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_detached, \"f\")) {\n      throw new Error(`Execution context is not available in detached frame \"${__classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\").url()}\" (are you trying to evaluate?)`);\n    }\n    if (__classPrivateFieldGet(this, _IsolatedWorld_context, \"f\") === null) {\n      throw new Error(`Execution content promise is missing`);\n    }\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n  }\n  async evaluateHandle(pageFunction) {\n    const context = await this.executionContext();\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n  async evaluate(pageFunction) {\n    const context = await this.executionContext();\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n    return context.evaluate(pageFunction, ...args);\n  }\n  async $(selector) {\n    const document = await this.document();\n    return document.$(selector);\n  }\n  async $$(selector) {\n    const document = await this.document();\n    return document.$$(selector);\n  }\n  async document() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_document, \"f\")) {\n      return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n    }\n    const context = await this.executionContext();\n    __classPrivateFieldSet(this, _IsolatedWorld_document, await context.evaluateHandle(() => {\n      return document;\n    }), \"f\");\n    return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n  }\n  async $x(expression) {\n    const document = await this.document();\n    return document.$x(expression);\n  }\n  async $eval(selector, pageFunction) {\n    const document = await this.document();\n    for (var _len3 = arguments.length, args = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n      args[_key3 - 2] = arguments[_key3];\n    }\n    return document.$eval(selector, pageFunction, ...args);\n  }\n  async $$eval(selector, pageFunction) {\n    const document = await this.document();\n    for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n      args[_key4 - 2] = arguments[_key4];\n    }\n    return document.$$eval(selector, pageFunction, ...args);\n  }\n  async content() {\n    return await this.evaluate(() => {\n      let retVal = '';\n      if (document.doctype) {\n        retVal = new XMLSerializer().serializeToString(document.doctype);\n      }\n      if (document.documentElement) {\n        retVal += document.documentElement.outerHTML;\n      }\n      return retVal;\n    });\n  }\n  async setContent(html) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      waitUntil = ['load'],\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).navigationTimeout()\n    } = options;\n    // We rely upon the fact that document.open() will reset frame lifecycle with \"init\"\n    // lifecycle event. @see https://crrev.com/608658\n    await this.evaluate(html => {\n      document.open();\n      document.write(html);\n      document.close();\n    }, html);\n    const watcher = new LifecycleWatcher_js_1.LifecycleWatcher(__classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get), __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\"), waitUntil, timeout);\n    const error = await Promise.race([watcher.timeoutOrTerminationPromise(), watcher.lifecyclePromise()]);\n    watcher.dispose();\n    if (error) {\n      throw error;\n    }\n  }\n  async click(selector, options) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.click(options);\n    await handle.dispose();\n  }\n  async focus(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.focus();\n    await handle.dispose();\n  }\n  async hover(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.hover();\n    await handle.dispose();\n  }\n  async select(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    for (var _len5 = arguments.length, values = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      values[_key5 - 1] = arguments[_key5];\n    }\n    const result = await handle.select(...values);\n    await handle.dispose();\n    return result;\n  }\n  async tap(selector) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.tap();\n    await handle.dispose();\n  }\n  async type(selector, text, options) {\n    const handle = await this.$(selector);\n    (0, assert_js_1.assert)(handle, `No element found for selector: ${selector}`);\n    await handle.type(text, options);\n    await handle.dispose();\n  }\n  async _addBindingToContext(context, name) {\n    // Previous operation added the binding so we are done.\n    if (__classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").has(__classPrivateFieldGet(IsolatedWorld, _a, \"f\", _IsolatedWorld_bindingIdentifier).call(IsolatedWorld, name, context._contextId))) {\n      return;\n    }\n    // Wait for other operation to finish\n    if (__classPrivateFieldGet(this, _IsolatedWorld_settingUpBinding, \"f\")) {\n      await __classPrivateFieldGet(this, _IsolatedWorld_settingUpBinding, \"f\");\n      return this._addBindingToContext(context, name);\n    }\n    const bind = async name => {\n      const expression = (0, util_js_1.pageBindingInitString)('internal', name);\n      try {\n        // TODO: In theory, it would be enough to call this just once\n        await context._client.send('Runtime.addBinding', {\n          name,\n          executionContextName: context._contextName\n        });\n        await context.evaluate(expression);\n      } catch (error) {\n        // We could have tried to evaluate in a context which was already\n        // destroyed. This happens, for example, if the page is navigated while\n        // we are trying to add the binding\n        if (error instanceof Error) {\n          // Destroyed context.\n          if (error.message.includes('Execution context was destroyed')) {\n            return;\n          }\n          // Missing context.\n          if (error.message.includes('Cannot find context with specified id')) {\n            return;\n          }\n        }\n        (0, util_js_1.debugError)(error);\n        return;\n      }\n      __classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").add(__classPrivateFieldGet(IsolatedWorld, _a, \"f\", _IsolatedWorld_bindingIdentifier).call(IsolatedWorld, name, context._contextId));\n    };\n    __classPrivateFieldSet(this, _IsolatedWorld_settingUpBinding, bind(name), \"f\");\n    await __classPrivateFieldGet(this, _IsolatedWorld_settingUpBinding, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_settingUpBinding, null, \"f\");\n  }\n  async _waitForSelectorInPage(queryOne, root, selector, options) {\n    let bindings = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : new Map();\n    const {\n      visible: waitForVisible = false,\n      hidden: waitForHidden = false,\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout()\n    } = options;\n    try {\n      const handle = await this.waitForFunction(async (PuppeteerUtil, query, selector, root, visible) => {\n        if (!PuppeteerUtil) {\n          return;\n        }\n        const node = await PuppeteerUtil.createFunction(query)(root || document, selector, PuppeteerUtil);\n        return PuppeteerUtil.checkVisibility(node, visible);\n      }, {\n        bindings,\n        polling: waitForVisible || waitForHidden ? 'raf' : 'mutation',\n        root,\n        timeout\n      }, new LazyArg_js_1.LazyArg(async () => {\n        try {\n          // In case CDP fails.\n          return await this.puppeteerUtil;\n        } catch {\n          return undefined;\n        }\n      }), queryOne.toString(), selector, root, waitForVisible ? true : waitForHidden ? false : undefined);\n      const elementHandle = handle.asElement();\n      if (!elementHandle) {\n        await handle.dispose();\n        return null;\n      }\n      return elementHandle;\n    } catch (error) {\n      if (!(0, ErrorLike_js_1.isErrorLike)(error)) {\n        throw error;\n      }\n      error.message = `Waiting for selector \\`${selector}\\` failed: ${error.message}`;\n      throw error;\n    }\n  }\n  waitForFunction(pageFunction) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      polling = 'raf',\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout(),\n      bindings,\n      root\n    } = options;\n    if (typeof polling === 'number' && polling < 0) {\n      throw new Error('Cannot poll with non-positive interval');\n    }\n    for (var _len6 = arguments.length, args = new Array(_len6 > 2 ? _len6 - 2 : 0), _key6 = 2; _key6 < _len6; _key6++) {\n      args[_key6 - 2] = arguments[_key6];\n    }\n    const waitTask = new WaitTask_js_1.WaitTask(this, {\n      bindings,\n      polling,\n      root,\n      timeout\n    }, pageFunction, ...args);\n    return waitTask.result;\n  }\n  async title() {\n    return this.evaluate(() => {\n      return document.title;\n    });\n  }\n  async adoptBackendNode(backendNodeId) {\n    const executionContext = await this.executionContext();\n    const {\n      object\n    } = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.resolveNode', {\n      backendNodeId: backendNodeId,\n      executionContextId: executionContext._contextId\n    });\n    return (0, util_js_1.createJSHandle)(executionContext, object);\n  }\n  async adoptHandle(handle) {\n    const executionContext = await this.executionContext();\n    (0, assert_js_1.assert)(handle.executionContext() !== executionContext, 'Cannot adopt handle that already belongs to this execution context');\n    const nodeInfo = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.remoteObject().objectId\n    });\n    return await this.adoptBackendNode(nodeInfo.node.backendNodeId);\n  }\n  async transferHandle(handle) {\n    const result = await this.adoptHandle(handle);\n    await handle.dispose();\n    return result;\n  }\n}\nexports.IsolatedWorld = IsolatedWorld;\n_a = IsolatedWorld, _IsolatedWorld_frame = new WeakMap(), _IsolatedWorld_document = new WeakMap(), _IsolatedWorld_context = new WeakMap(), _IsolatedWorld_detached = new WeakMap(), _IsolatedWorld_ctxBindings = new WeakMap(), _IsolatedWorld_boundFunctions = new WeakMap(), _IsolatedWorld_taskManager = new WeakMap(), _IsolatedWorld_puppeteerUtil = new WeakMap(), _IsolatedWorld_settingUpBinding = new WeakMap(), _IsolatedWorld_onBindingCalled = new WeakMap(), _IsolatedWorld_instances = new WeakSet(), _IsolatedWorld_client_get = function _IsolatedWorld_client_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._client();\n}, _IsolatedWorld_frameManager_get = function _IsolatedWorld_frameManager_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._frameManager;\n}, _IsolatedWorld_timeoutSettings_get = function _IsolatedWorld_timeoutSettings_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get).timeoutSettings;\n}, _IsolatedWorld_injectPuppeteerUtil = async function _IsolatedWorld_injectPuppeteerUtil(context) {\n  try {\n    __classPrivateFieldGet(this, _IsolatedWorld_puppeteerUtil, \"f\").resolve(await context.evaluateHandle(`(() => {\n              const module = {};\n              ${injected_js_1.source}\n              return module.exports.default;\n            })()`));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").rerunAll();\n  } catch (error) {\n    (0, util_js_1.debugError)(error);\n  }\n};\n_IsolatedWorld_bindingIdentifier = {\n  value: (name, contextId) => {\n    return `${name}_${contextId}`;\n  }\n};","map":{"version":3,"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA;AAEA;AACA;AACA;AAQA;AACA;AAGA;AACA;AAsCA;;;;;;AAMaA,kBAAU,GAAGC,MAAM,CAAC,WAAW,CAAC;AAC7C;;;;;;AAMaD,uBAAe,GAAGC,MAAM,CAAC,gBAAgB,CAAC;AAUvD;;;AAGA,MAAaC,aAAa;EA8BxBC,YAAYC,KAAY;;IA7BxBC;IACAC;IACAC,iCAAW,8CAAqB,GAAoB;IACpDC,kCAAY,KAAK;IAEjB;IACAC,qCAAe,IAAIC,GAAG,EAAU;IAEhC;IACAC,wCAAkB,IAAIC,GAAG,EAAoB;IAC7CC,qCAAe,IAAIC,yBAAW,EAAE;IAChCC,uCAAiB,8CAAqB,GAA2B;IAiRjE;IACA;IACAC,0CAA0C,IAAI;IAyD9CC,yCAAmB,MACjBC,KAA0C,IACzB;MACjB,IAAIC,OAAmE;MACvE,IAAI,CAAC,IAAI,CAACC,UAAU,EAAE,EAAE;QACtB;;MAEF,MAAMC,OAAO,GAAG,MAAM,IAAI,CAACC,gBAAgB,EAAE;MAC7C,IAAI;QACFH,OAAO,GAAGI,IAAI,CAACC,KAAK,CAACN,KAAK,CAACC,OAAO,CAAC;OACpC,CAAC,MAAM;QACN;QACA;QACA;;MAEF,MAAM;QAACM,IAAI;QAAEC,IAAI;QAAEC,GAAG;QAAEC;MAAI,CAAC,GAAGT,OAAO;MACvC,IACEM,IAAI,KAAK,UAAU,IACnB,CAACI,2BAAI,kCAAa,CAACC,GAAG,CACpBD,oCAAa,4CAAmB,MAAhC3B,aAAa,EAAoBwB,IAAI,EAAEL,OAAO,CAACU,UAAU,CAAC,CAC3D,EACD;QACA;;MAEF,IAAIV,OAAO,CAACU,UAAU,KAAKb,KAAK,CAACc,kBAAkB,EAAE;QACnD;;MAEF,IAAI;QACF,MAAMC,EAAE,GAAG,IAAI,CAACC,eAAe,CAACC,GAAG,CAACT,IAAI,CAAC;QACzC,IAAI,CAACO,EAAE,EAAE;UACP,MAAM,IAAIG,KAAK,CAAC,mCAAmC,CAAC;;QAEtD,MAAMC,MAAM,GAAG,MAAMJ,EAAE,CAAC,GAAGL,IAAI,CAAC;QAChC,MAAMP,OAAO,CAACiB,QAAQ,CACpB,CAACZ,IAAY,EAAEC,GAAW,EAAEU,MAAe,KAAI;UAC7C;UACA,MAAME,SAAS,GAAGC,IAAI,CAACd,IAAI,CAAC,CAACa,SAAS;UACtCA,SAAS,CAACJ,GAAG,CAACR,GAAG,CAAC,CAACc,OAAO,CAACJ,MAAM,CAAC;UAClCE,SAAS,CAACG,MAAM,CAACf,GAAG,CAAC;QACvB,CAAC,EACDD,IAAI,EACJC,GAAG,EACHU,MAAM,CACP;OACF,CAAC,OAAOM,KAAK,EAAE;QACd;QACA;QACA;QACA;QACA;QACA,IAAKA,KAAe,CAACC,OAAO,CAACC,QAAQ,CAAC,gBAAgB,CAAC,EAAE;UACvD;;QAEF,wBAAU,EAACF,KAAK,CAAC;;IAErB,CAAC;IAhXC;IACA;IACAG,2BAAI,wBAAU1C,KAAK;IACnByB,2BAAI,2DAAQ,CAACkB,EAAE,CAAC,uBAAuB,EAAElB,2BAAI,sCAAiB,CAAC;EACjE;EArBA,IAAImB,aAAa;IACf,OAAOnB,2BAAI,oCAAe;EAC5B;EAEA,IAAIoB,WAAW;IACb,OAAOpB,2BAAI,kCAAa;EAC1B;EAEA,IAAIK,eAAe;IACjB,OAAOL,2BAAI,qCAAgB;EAC7B;EAyBAzB,KAAK;IACH,OAAOyB,2BAAI,4BAAO;EACpB;EAEAqB,YAAY;IACVJ,2BAAI,2BAAaK,SAAS;IAC1BL,2BAAI,gCAAkB,8CAAqB,GAAE;IAC7CA,2BAAI,0BAAY,8CAAqB,GAAE;EACzC;EAEAM,UAAU,CAAC/B,OAAyB;IAClCQ,2BAAI,oEAAqB,MAAzB,IAAI,EAAsBR,OAAO,CAAC;IAClCQ,2BAAI,kCAAa,CAACwB,KAAK,EAAE;IACzBxB,2BAAI,8BAAS,CAACY,OAAO,CAACpB,OAAO,CAAC;EAChC;EAmBAD,UAAU;IACR,OAAOS,2BAAI,8BAAS,CAACyB,QAAQ,EAAE;EACjC;EAEAC,OAAO;IACLT,2BAAI,2BAAa,IAAI;IACrBjB,2BAAI,2DAAQ,CAAC2B,GAAG,CAAC,uBAAuB,EAAE3B,2BAAI,sCAAiB,CAAC;IAChEA,2BAAI,kCAAa,CAAC4B,YAAY,CAC5B,IAAIrB,KAAK,CAAC,6CAA6C,CAAC,CACzD;EACH;EAEAd,gBAAgB;IACd,IAAIO,2BAAI,+BAAU,EAAE;MAClB,MAAM,IAAIO,KAAK,CACb,yDAAyDP,2BAAI,4BAAO,CAAC6B,GAAG,EAAE,iCAAiC,CAC5G;;IAEH,IAAI7B,2BAAI,8BAAS,KAAK,IAAI,EAAE;MAC1B,MAAM,IAAIO,KAAK,CAAC,sCAAsC,CAAC;;IAEzD,OAAOP,2BAAI,8BAAS;EACtB;EAEA,MAAM8B,cAAc,CAIlBC,YAA2B,EACZ;IAEf,MAAMvC,OAAO,GAAG,MAAM,IAAI,CAACC,gBAAgB,EAAE;IAAC,kCAF3CM,IAAY;MAAZA,IAAY;IAAA;IAGf,OAAOP,OAAO,CAACsC,cAAc,CAACC,YAAY,EAAE,GAAGhC,IAAI,CAAC;EACtD;EAEA,MAAMU,QAAQ,CAIZsB,YAA2B,EACZ;IAEf,MAAMvC,OAAO,GAAG,MAAM,IAAI,CAACC,gBAAgB,EAAE;IAAC,mCAF3CM,IAAY;MAAZA,IAAY;IAAA;IAGf,OAAOP,OAAO,CAACiB,QAAQ,CAACsB,YAAY,EAAE,GAAGhC,IAAI,CAAC;EAChD;EAEA,MAAMiC,CAAC,CACLC,QAAkB;IAElB,MAAMC,QAAQ,GAAG,MAAM,IAAI,CAACA,QAAQ,EAAE;IACtC,OAAOA,QAAQ,CAACF,CAAC,CAACC,QAAQ,CAAC;EAC7B;EAEA,MAAME,EAAE,CACNF,QAAkB;IAElB,MAAMC,QAAQ,GAAG,MAAM,IAAI,CAACA,QAAQ,EAAE;IACtC,OAAOA,QAAQ,CAACC,EAAE,CAACF,QAAQ,CAAC;EAC9B;EAEA,MAAMC,QAAQ;IACZ,IAAIlC,2BAAI,+BAAU,EAAE;MAClB,OAAOA,2BAAI,+BAAU;;IAEvB,MAAMR,OAAO,GAAG,MAAM,IAAI,CAACC,gBAAgB,EAAE;IAC7CwB,2BAAI,2BAAa,MAAMzB,OAAO,CAACsC,cAAc,CAAC,MAAK;MACjD,OAAOI,QAAQ;IACjB,CAAC,CAAC;IACF,OAAOlC,2BAAI,+BAAU;EACvB;EAEA,MAAMoC,EAAE,CAACC,UAAkB;IACzB,MAAMH,QAAQ,GAAG,MAAM,IAAI,CAACA,QAAQ,EAAE;IACtC,OAAOA,QAAQ,CAACE,EAAE,CAACC,UAAU,CAAC;EAChC;EAEA,MAAMC,KAAK,CAOTL,QAAkB,EAClBF,YAA2B,EACZ;IAEf,MAAMG,QAAQ,GAAG,MAAM,IAAI,CAACA,QAAQ,EAAE;IAAC,mCAFpCnC,IAAY;MAAZA,IAAY;IAAA;IAGf,OAAOmC,QAAQ,CAACI,KAAK,CAACL,QAAQ,EAAEF,YAAY,EAAE,GAAGhC,IAAI,CAAC;EACxD;EAEA,MAAMwC,MAAM,CAOVN,QAAkB,EAClBF,YAA2B,EACZ;IAEf,MAAMG,QAAQ,GAAG,MAAM,IAAI,CAACA,QAAQ,EAAE;IAAC,mCAFpCnC,IAAY;MAAZA,IAAY;IAAA;IAGf,OAAOmC,QAAQ,CAACK,MAAM,CAACN,QAAQ,EAAEF,YAAY,EAAE,GAAGhC,IAAI,CAAC;EACzD;EAEA,MAAMyC,OAAO;IACX,OAAO,MAAM,IAAI,CAAC/B,QAAQ,CAAC,MAAK;MAC9B,IAAIgC,MAAM,GAAG,EAAE;MACf,IAAIP,QAAQ,CAACQ,OAAO,EAAE;QACpBD,MAAM,GAAG,IAAIE,aAAa,EAAE,CAACC,iBAAiB,CAACV,QAAQ,CAACQ,OAAO,CAAC;;MAElE,IAAIR,QAAQ,CAACW,eAAe,EAAE;QAC5BJ,MAAM,IAAIP,QAAQ,CAACW,eAAe,CAACC,SAAS;;MAE9C,OAAOL,MAAM;IACf,CAAC,CAAC;EACJ;EAEA,MAAMM,UAAU,CACdC,IAAY,EAIN;IAAA,IAHNC,8EAGI,EAAE;IAEN,MAAM;MACJC,SAAS,GAAG,CAAC,MAAM,CAAC;MACpBC,OAAO,GAAGnD,2BAAI,oEAAiB,CAACoD,iBAAiB;IAAE,CACpD,GAAGH,OAAO;IACX;IACA;IACA,MAAM,IAAI,CAACxC,QAAQ,CAACuC,IAAI,IAAG;MACzBd,QAAQ,CAACmB,IAAI,EAAE;MACfnB,QAAQ,CAACoB,KAAK,CAACN,IAAI,CAAC;MACpBd,QAAQ,CAACqB,KAAK,EAAE;IAClB,CAAC,EAAEP,IAAI,CAAC;IACR,MAAMQ,OAAO,GAAG,IAAIC,sCAAgB,CAClCzD,2BAAI,iEAAc,EAClBA,2BAAI,4BAAO,EACXkD,SAAS,EACTC,OAAO,CACR;IACD,MAAMrC,KAAK,GAAG,MAAM4C,OAAO,CAACC,IAAI,CAAC,CAC/BH,OAAO,CAACI,2BAA2B,EAAE,EACrCJ,OAAO,CAACK,gBAAgB,EAAE,CAC3B,CAAC;IACFL,OAAO,CAACM,OAAO,EAAE;IACjB,IAAIhD,KAAK,EAAE;MACT,MAAMA,KAAK;;EAEf;EAEA,MAAMiD,KAAK,CACT9B,QAAgB,EAChBgB,OAAoE;IAEpE,MAAMe,MAAM,GAAG,MAAM,IAAI,CAAChC,CAAC,CAACC,QAAQ,CAAC;IACrC,sBAAM,EAAC+B,MAAM,EAAE,kCAAkC/B,QAAQ,EAAE,CAAC;IAC5D,MAAM+B,MAAM,CAACD,KAAK,CAACd,OAAO,CAAC;IAC3B,MAAMe,MAAM,CAACF,OAAO,EAAE;EACxB;EAEA,MAAMG,KAAK,CAAChC,QAAgB;IAC1B,MAAM+B,MAAM,GAAG,MAAM,IAAI,CAAChC,CAAC,CAACC,QAAQ,CAAC;IACrC,sBAAM,EAAC+B,MAAM,EAAE,kCAAkC/B,QAAQ,EAAE,CAAC;IAC5D,MAAM+B,MAAM,CAACC,KAAK,EAAE;IACpB,MAAMD,MAAM,CAACF,OAAO,EAAE;EACxB;EAEA,MAAMI,KAAK,CAACjC,QAAgB;IAC1B,MAAM+B,MAAM,GAAG,MAAM,IAAI,CAAChC,CAAC,CAACC,QAAQ,CAAC;IACrC,sBAAM,EAAC+B,MAAM,EAAE,kCAAkC/B,QAAQ,EAAE,CAAC;IAC5D,MAAM+B,MAAM,CAACE,KAAK,EAAE;IACpB,MAAMF,MAAM,CAACF,OAAO,EAAE;EACxB;EAEA,MAAMK,MAAM,CAAClC,QAAgB,EAAqB;IAChD,MAAM+B,MAAM,GAAG,MAAM,IAAI,CAAChC,CAAC,CAACC,QAAQ,CAAC;IACrC,sBAAM,EAAC+B,MAAM,EAAE,kCAAkC/B,QAAQ,EAAE,CAAC;IAAC,mCAF7BmC,MAAgB;MAAhBA,MAAgB;IAAA;IAGhD,MAAM5D,MAAM,GAAG,MAAMwD,MAAM,CAACG,MAAM,CAAC,GAAGC,MAAM,CAAC;IAC7C,MAAMJ,MAAM,CAACF,OAAO,EAAE;IACtB,OAAOtD,MAAM;EACf;EAEA,MAAM6D,GAAG,CAACpC,QAAgB;IACxB,MAAM+B,MAAM,GAAG,MAAM,IAAI,CAAChC,CAAC,CAACC,QAAQ,CAAC;IACrC,sBAAM,EAAC+B,MAAM,EAAE,kCAAkC/B,QAAQ,EAAE,CAAC;IAC5D,MAAM+B,MAAM,CAACK,GAAG,EAAE;IAClB,MAAML,MAAM,CAACF,OAAO,EAAE;EACxB;EAEA,MAAMlE,IAAI,CACRqC,QAAgB,EAChBqC,IAAY,EACZrB,OAAyB;IAEzB,MAAMe,MAAM,GAAG,MAAM,IAAI,CAAChC,CAAC,CAACC,QAAQ,CAAC;IACrC,sBAAM,EAAC+B,MAAM,EAAE,kCAAkC/B,QAAQ,EAAE,CAAC;IAC5D,MAAM+B,MAAM,CAACpE,IAAI,CAAC0E,IAAI,EAAErB,OAAO,CAAC;IAChC,MAAMe,MAAM,CAACF,OAAO,EAAE;EACxB;EAMA,MAAMS,oBAAoB,CACxB/E,OAAyB,EACzBK,IAAY;IAEZ;IACA,IACEG,2BAAI,kCAAa,CAACC,GAAG,CACnBD,oCAAa,4CAAmB,MAAhC3B,aAAa,EAAoBwB,IAAI,EAAEL,OAAO,CAACU,UAAU,CAAC,CAC3D,EACD;MACA;;IAEF;IACA,IAAIF,2BAAI,uCAAkB,EAAE;MAC1B,MAAMA,2BAAI,uCAAkB;MAC5B,OAAO,IAAI,CAACuE,oBAAoB,CAAC/E,OAAO,EAAEK,IAAI,CAAC;;IAGjD,MAAM2E,IAAI,GAAG,MAAO3E,IAAY,IAAI;MAClC,MAAMwC,UAAU,GAAG,mCAAqB,EAAC,UAAU,EAAExC,IAAI,CAAC;MAC1D,IAAI;QACF;QACA,MAAML,OAAO,CAACiF,OAAO,CAACC,IAAI,CAAC,oBAAoB,EAAE;UAC/C7E,IAAI;UACJ8E,oBAAoB,EAAEnF,OAAO,CAACoF;SAC/B,CAAC;QACF,MAAMpF,OAAO,CAACiB,QAAQ,CAAC4B,UAAU,CAAC;OACnC,CAAC,OAAOvB,KAAK,EAAE;QACd;QACA;QACA;QACA,IAAIA,KAAK,YAAYP,KAAK,EAAE;UAC1B;UACA,IAAIO,KAAK,CAACC,OAAO,CAACC,QAAQ,CAAC,iCAAiC,CAAC,EAAE;YAC7D;;UAEF;UACA,IAAIF,KAAK,CAACC,OAAO,CAACC,QAAQ,CAAC,uCAAuC,CAAC,EAAE;YACnE;;;QAIJ,wBAAU,EAACF,KAAK,CAAC;QACjB;;MAEFd,2BAAI,kCAAa,CAAC6E,GAAG,CACnB7E,oCAAa,4CAAmB,MAAhC3B,aAAa,EAAoBwB,IAAI,EAAEL,OAAO,CAACU,UAAU,CAAC,CAC3D;IACH,CAAC;IAEDe,2BAAI,mCAAqBuD,IAAI,CAAC3E,IAAI,CAAC;IACnC,MAAMG,2BAAI,uCAAkB;IAC5BiB,2BAAI,mCAAqB,IAAI;EAC/B;EA2DA,MAAM6D,sBAAsB,CAC1BC,QAAkB,EAClBC,IAAqC,EACrC/C,QAAgB,EAChBgB,OAA+B,EAC4B;IAAA,IAA3DgC,+EAAW,IAAIlG,GAAG,EAAyC;IAE3D,MAAM;MACJmG,OAAO,EAAEC,cAAc,GAAG,KAAK;MAC/BC,MAAM,EAAEC,aAAa,GAAG,KAAK;MAC7BlC,OAAO,GAAGnD,2BAAI,oEAAiB,CAACmD,OAAO;IAAE,CAC1C,GAAGF,OAAO;IAEX,IAAI;MACF,MAAMe,MAAM,GAAG,MAAM,IAAI,CAACsB,eAAe,CACvC,OAAOC,aAAa,EAAEC,KAAK,EAAEvD,QAAQ,EAAE+C,IAAI,EAAEE,OAAO,KAAI;QACtD,IAAI,CAACK,aAAa,EAAE;UAClB;;QAEF,MAAME,IAAI,GAAI,MAAMF,aAAa,CAACG,cAAc,CAACF,KAAK,CAAC,CACrDR,IAAI,IAAI9C,QAAQ,EAChBD,QAAQ,EACRsD,aAAa,CACE;QACjB,OAAOA,aAAa,CAACI,eAAe,CAACF,IAAI,EAAEP,OAAO,CAAC;MACrD,CAAC,EACD;QACED,QAAQ;QACRW,OAAO,EAAET,cAAc,IAAIE,aAAa,GAAG,KAAK,GAAG,UAAU;QAC7DL,IAAI;QACJ7B;OACD,EACD,IAAI0C,oBAAO,CAAC,YAAW;QACrB,IAAI;UACF;UACA,OAAO,MAAM,IAAI,CAAC1E,aAAa;SAChC,CAAC,MAAM;UACN,OAAOG,SAAS;;MAEpB,CAAC,CAAC,EACFyD,QAAQ,CAACe,QAAQ,EAAE,EACnB7D,QAAQ,EACR+C,IAAI,EACJG,cAAc,GAAG,IAAI,GAAGE,aAAa,GAAG,KAAK,GAAG/D,SAAS,CAC1D;MACD,MAAMyE,aAAa,GAAG/B,MAAM,CAACgC,SAAS,EAAE;MACxC,IAAI,CAACD,aAAa,EAAE;QAClB,MAAM/B,MAAM,CAACF,OAAO,EAAE;QACtB,OAAO,IAAI;;MAEb,OAAOiC,aAAa;KACrB,CAAC,OAAOjF,KAAK,EAAE;MACd,IAAI,CAAC,8BAAW,EAACA,KAAK,CAAC,EAAE;QACvB,MAAMA,KAAK;;MAEbA,KAAK,CAACC,OAAO,GAAG,0BAA0BkB,QAAQ,cAAcnB,KAAK,CAACC,OAAO,EAAE;MAC/E,MAAMD,KAAK;;EAEf;EAEAwE,eAAe,CAMbvD,YAA2B,EAOZ;IAAA,IANfkB,8EAKI,EAAE;IAGN,MAAM;MACJ2C,OAAO,GAAG,KAAK;MACfzC,OAAO,GAAGnD,2BAAI,oEAAiB,CAACmD,OAAO,EAAE;MACzC8B,QAAQ;MACRD;IAAI,CACL,GAAG/B,OAAO;IACX,IAAI,OAAO2C,OAAO,KAAK,QAAQ,IAAIA,OAAO,GAAG,CAAC,EAAE;MAC9C,MAAM,IAAIrF,KAAK,CAAC,wCAAwC,CAAC;;IAC1D,mCAVER,IAAY;MAAZA,IAAY;IAAA;IAWf,MAAMkG,QAAQ,GAAG,IAAIhH,sBAAQ,CAC3B,IAAI,EACJ;MACEgG,QAAQ;MACRW,OAAO;MACPZ,IAAI;MACJ7B;KACD,EACDpB,YAEU,EACV,GAAGhC,IAAI,CACR;IACD,OAAOkG,QAAQ,CAACzF,MAAM;EACxB;EAEA,MAAM0F,KAAK;IACT,OAAO,IAAI,CAACzF,QAAQ,CAAC,MAAK;MACxB,OAAOyB,QAAQ,CAACgE,KAAK;IACvB,CAAC,CAAC;EACJ;EAEA,MAAMC,gBAAgB,CACpBC,aAA0C;IAE1C,MAAM3G,gBAAgB,GAAG,MAAM,IAAI,CAACA,gBAAgB,EAAE;IACtD,MAAM;MAAC4G;IAAM,CAAC,GAAG,MAAMrG,2BAAI,2DAAQ,CAAC0E,IAAI,CAAC,iBAAiB,EAAE;MAC1D0B,aAAa,EAAEA,aAAa;MAC5BjG,kBAAkB,EAAEV,gBAAgB,CAACS;KACtC,CAAC;IACF,OAAO,4BAAc,EAACT,gBAAgB,EAAE4G,MAAM,CAAmB;EACnE;EAEA,MAAMC,WAAW,CAA2BtC,MAAS;IACnD,MAAMvE,gBAAgB,GAAG,MAAM,IAAI,CAACA,gBAAgB,EAAE;IACtD,sBAAM,EACJuE,MAAM,CAACvE,gBAAgB,EAAE,KAAKA,gBAAgB,EAC9C,oEAAoE,CACrE;IACD,MAAM8G,QAAQ,GAAG,MAAMvG,2BAAI,2DAAQ,CAAC0E,IAAI,CAAC,kBAAkB,EAAE;MAC3D8B,QAAQ,EAAExC,MAAM,CAACyC,YAAY,EAAE,CAACD;KACjC,CAAC;IACF,OAAQ,MAAM,IAAI,CAACL,gBAAgB,CAACI,QAAQ,CAACd,IAAI,CAACW,aAAa,CAAC;EAClE;EAEA,MAAMM,cAAc,CAA2B1C,MAAS;IACtD,MAAMxD,MAAM,GAAG,MAAM,IAAI,CAAC8F,WAAW,CAACtC,MAAM,CAAC;IAC7C,MAAMA,MAAM,CAACF,OAAO,EAAE;IACtB,OAAOtD,MAAM;EACf;;AAthBFrC;;EAsCI,OAAO6B,2BAAI,4BAAO,CAACyE,OAAO,EAAE;AAC9B,CAAC;EAGC,OAAOzE,2BAAI,4BAAO,CAAC2G,aAAa;AAClC,CAAC;EAGC,OAAO3G,2BAAI,iEAAc,CAAC4G,eAAe;AAC3C,CAAC,uCAkBD,eAAKC,mCAAsBrH,OAAyB;EAClD,IAAI;IACFQ,2BAAI,oCAAe,CAACY,OAAO,CACxB,MAAMpB,OAAO,CAACsC,cAAc,CAC3B;;gBAEMgF,oBAAc;;iBAEb,CACR,CACF;IACD9G,2BAAI,kCAAa,CAAC+G,QAAQ,EAAE;GAC7B,CAAC,OAAOjG,KAAc,EAAE;IACvB,wBAAU,EAACA,KAAK,CAAC;;AAErB,CAAC;AAtDMkG;EAAAC,OAAqB,CAACpH,IAAY,EAAEqH,SAAiB,KAAI;IAC9D,OAAO,GAAGrH,IAAI,IAAIqH,SAAS,EAAE;EAC/B;AAAC","names":["exports","Symbol","IsolatedWorld","constructor","frame","_IsolatedWorld_frame","_IsolatedWorld_document","_IsolatedWorld_context","_IsolatedWorld_detached","_IsolatedWorld_ctxBindings","Set","_IsolatedWorld_boundFunctions","Map","_IsolatedWorld_taskManager","WaitTask_js_1","_IsolatedWorld_puppeteerUtil","_IsolatedWorld_settingUpBinding","_IsolatedWorld_onBindingCalled","event","payload","hasContext","context","executionContext","JSON","parse","type","name","seq","args","__classPrivateFieldGet","has","_contextId","executionContextId","fn","_boundFunctions","get","Error","result","evaluate","callbacks","self","resolve","delete","error","message","includes","__classPrivateFieldSet","on","puppeteerUtil","taskManager","clearContext","undefined","setContext","clear","resolved","_detach","off","terminateAll","url","evaluateHandle","pageFunction","$","selector","document","$$","$x","expression","$eval","$$eval","content","retVal","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","options","waitUntil","timeout","navigationTimeout","open","write","close","watcher","LifecycleWatcher_js_1","Promise","race","timeoutOrTerminationPromise","lifecyclePromise","dispose","click","handle","focus","hover","select","values","tap","text","_addBindingToContext","bind","_client","send","executionContextName","_contextName","add","_waitForSelectorInPage","queryOne","root","bindings","visible","waitForVisible","hidden","waitForHidden","waitForFunction","PuppeteerUtil","query","node","createFunction","checkVisibility","polling","LazyArg_js_1","toString","elementHandle","asElement","waitTask","title","adoptBackendNode","backendNodeId","object","adoptHandle","nodeInfo","objectId","remoteObject","transferHandle","_frameManager","timeoutSettings","_IsolatedWorld_injectPuppeteerUtil","injected_js_1","rerunAll","_IsolatedWorld_bindingIdentifier","value","contextId"],"sources":["../../../../src/common/IsolatedWorld.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}