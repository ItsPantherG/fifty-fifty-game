{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _Target_browserContext, _Target_session, _Target_targetInfo, _Target_sessionFactory, _Target_ignoreHTTPSErrors, _Target_defaultViewport, _Target_pagePromise, _Target_workerPromise, _Target_screenshotTaskQueue, _Target_targetManager;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Target = void 0;\nconst WebWorker_js_1 = require(\"./WebWorker.js\");\nconst Page_js_1 = require(\"./Page.js\");\n/**\n * @public\n */\nclass Target {\n  /**\n   * @internal\n   */\n  constructor(targetInfo, session, browserContext, targetManager, sessionFactory, ignoreHTTPSErrors, defaultViewport, screenshotTaskQueue, isPageTargetCallback) {\n    _Target_browserContext.set(this, void 0);\n    _Target_session.set(this, void 0);\n    _Target_targetInfo.set(this, void 0);\n    _Target_sessionFactory.set(this, void 0);\n    _Target_ignoreHTTPSErrors.set(this, void 0);\n    _Target_defaultViewport.set(this, void 0);\n    _Target_pagePromise.set(this, void 0);\n    _Target_workerPromise.set(this, void 0);\n    _Target_screenshotTaskQueue.set(this, void 0);\n    _Target_targetManager.set(this, void 0);\n    __classPrivateFieldSet(this, _Target_session, session, \"f\");\n    __classPrivateFieldSet(this, _Target_targetManager, targetManager, \"f\");\n    __classPrivateFieldSet(this, _Target_targetInfo, targetInfo, \"f\");\n    __classPrivateFieldSet(this, _Target_browserContext, browserContext, \"f\");\n    this._targetId = targetInfo.targetId;\n    __classPrivateFieldSet(this, _Target_sessionFactory, sessionFactory, \"f\");\n    __classPrivateFieldSet(this, _Target_ignoreHTTPSErrors, ignoreHTTPSErrors, \"f\");\n    __classPrivateFieldSet(this, _Target_defaultViewport, defaultViewport !== null && defaultViewport !== void 0 ? defaultViewport : undefined, \"f\");\n    __classPrivateFieldSet(this, _Target_screenshotTaskQueue, screenshotTaskQueue, \"f\");\n    this._isPageTargetCallback = isPageTargetCallback;\n    this._initializedPromise = new Promise(fulfill => {\n      return this._initializedCallback = fulfill;\n    }).then(async success => {\n      if (!success) {\n        return false;\n      }\n      const opener = this.opener();\n      if (!opener || !__classPrivateFieldGet(opener, _Target_pagePromise, \"f\") || this.type() !== 'page') {\n        return true;\n      }\n      const openerPage = await __classPrivateFieldGet(opener, _Target_pagePromise, \"f\");\n      if (!openerPage.listenerCount(\"popup\" /* PageEmittedEvents.Popup */)) {\n        return true;\n      }\n      const popupPage = await this.page();\n      openerPage.emit(\"popup\" /* PageEmittedEvents.Popup */, popupPage);\n      return true;\n    });\n    this._isClosedPromise = new Promise(fulfill => {\n      return this._closedCallback = fulfill;\n    });\n    this._isInitialized = !this._isPageTargetCallback(__classPrivateFieldGet(this, _Target_targetInfo, \"f\")) || __classPrivateFieldGet(this, _Target_targetInfo, \"f\").url !== '';\n    if (this._isInitialized) {\n      this._initializedCallback(true);\n    }\n  }\n  /**\n   * @internal\n   */\n  _session() {\n    return __classPrivateFieldGet(this, _Target_session, \"f\");\n  }\n  /**\n   * Creates a Chrome Devtools Protocol session attached to the target.\n   */\n  createCDPSession() {\n    return __classPrivateFieldGet(this, _Target_sessionFactory, \"f\").call(this, false);\n  }\n  /**\n   * @internal\n   */\n  _targetManager() {\n    return __classPrivateFieldGet(this, _Target_targetManager, \"f\");\n  }\n  /**\n   * @internal\n   */\n  _getTargetInfo() {\n    return __classPrivateFieldGet(this, _Target_targetInfo, \"f\");\n  }\n  /**\n   * If the target is not of type `\"page\"` or `\"background_page\"`, returns `null`.\n   */\n  async page() {\n    var _a;\n    if (this._isPageTargetCallback(__classPrivateFieldGet(this, _Target_targetInfo, \"f\")) && !__classPrivateFieldGet(this, _Target_pagePromise, \"f\")) {\n      __classPrivateFieldSet(this, _Target_pagePromise, (__classPrivateFieldGet(this, _Target_session, \"f\") ? Promise.resolve(__classPrivateFieldGet(this, _Target_session, \"f\")) : __classPrivateFieldGet(this, _Target_sessionFactory, \"f\").call(this, true)).then(client => {\n        var _a;\n        return Page_js_1.CDPPage._create(client, this, __classPrivateFieldGet(this, _Target_ignoreHTTPSErrors, \"f\"), (_a = __classPrivateFieldGet(this, _Target_defaultViewport, \"f\")) !== null && _a !== void 0 ? _a : null, __classPrivateFieldGet(this, _Target_screenshotTaskQueue, \"f\"));\n      }), \"f\");\n    }\n    return (_a = await __classPrivateFieldGet(this, _Target_pagePromise, \"f\")) !== null && _a !== void 0 ? _a : null;\n  }\n  /**\n   * If the target is not of type `\"service_worker\"` or `\"shared_worker\"`, returns `null`.\n   */\n  async worker() {\n    if (__classPrivateFieldGet(this, _Target_targetInfo, \"f\").type !== 'service_worker' && __classPrivateFieldGet(this, _Target_targetInfo, \"f\").type !== 'shared_worker') {\n      return null;\n    }\n    if (!__classPrivateFieldGet(this, _Target_workerPromise, \"f\")) {\n      // TODO(einbinder): Make workers send their console logs.\n      __classPrivateFieldSet(this, _Target_workerPromise, (__classPrivateFieldGet(this, _Target_session, \"f\") ? Promise.resolve(__classPrivateFieldGet(this, _Target_session, \"f\")) : __classPrivateFieldGet(this, _Target_sessionFactory, \"f\").call(this, false)).then(client => {\n        return new WebWorker_js_1.WebWorker(client, __classPrivateFieldGet(this, _Target_targetInfo, \"f\").url, () => {} /* consoleAPICalled */, () => {} /* exceptionThrown */);\n      }), \"f\");\n    }\n    return __classPrivateFieldGet(this, _Target_workerPromise, \"f\");\n  }\n  url() {\n    return __classPrivateFieldGet(this, _Target_targetInfo, \"f\").url;\n  }\n  /**\n   * Identifies what kind of target this is.\n   *\n   * @remarks\n   *\n   * See {@link https://developer.chrome.com/extensions/background_pages | docs} for more info about background pages.\n   */\n  type() {\n    const type = __classPrivateFieldGet(this, _Target_targetInfo, \"f\").type;\n    if (type === 'page' || type === 'background_page' || type === 'service_worker' || type === 'shared_worker' || type === 'browser' || type === 'webview') {\n      return type;\n    }\n    return 'other';\n  }\n  /**\n   * Get the browser the target belongs to.\n   */\n  browser() {\n    return __classPrivateFieldGet(this, _Target_browserContext, \"f\").browser();\n  }\n  /**\n   * Get the browser context the target belongs to.\n   */\n  browserContext() {\n    return __classPrivateFieldGet(this, _Target_browserContext, \"f\");\n  }\n  /**\n   * Get the target that opened this target. Top-level targets return `null`.\n   */\n  opener() {\n    const {\n      openerId\n    } = __classPrivateFieldGet(this, _Target_targetInfo, \"f\");\n    if (!openerId) {\n      return;\n    }\n    return this.browser()._targets.get(openerId);\n  }\n  /**\n   * @internal\n   */\n  _targetInfoChanged(targetInfo) {\n    __classPrivateFieldSet(this, _Target_targetInfo, targetInfo, \"f\");\n    if (!this._isInitialized && (!this._isPageTargetCallback(__classPrivateFieldGet(this, _Target_targetInfo, \"f\")) || __classPrivateFieldGet(this, _Target_targetInfo, \"f\").url !== '')) {\n      this._isInitialized = true;\n      this._initializedCallback(true);\n      return;\n    }\n  }\n}\nexports.Target = Target;\n_Target_browserContext = new WeakMap(), _Target_session = new WeakMap(), _Target_targetInfo = new WeakMap(), _Target_sessionFactory = new WeakMap(), _Target_ignoreHTTPSErrors = new WeakMap(), _Target_defaultViewport = new WeakMap(), _Target_pagePromise = new WeakMap(), _Target_workerPromise = new WeakMap(), _Target_screenshotTaskQueue = new WeakMap(), _Target_targetManager = new WeakMap();","map":{"version":3,"mappings":"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","names":["Target","constructor","targetInfo","session","browserContext","targetManager","sessionFactory","ignoreHTTPSErrors","defaultViewport","screenshotTaskQueue","isPageTargetCallback","_Target_browserContext","_Target_session","_Target_targetInfo","_Target_sessionFactory","_Target_ignoreHTTPSErrors","_Target_defaultViewport","_Target_pagePromise","_Target_workerPromise","_Target_screenshotTaskQueue","_Target_targetManager","__classPrivateFieldSet","_targetId","targetId","undefined","_isPageTargetCallback","_initializedPromise","Promise","fulfill","_initializedCallback","then","success","opener","__classPrivateFieldGet","type","openerPage","listenerCount","popupPage","page","emit","_isClosedPromise","_closedCallback","_isInitialized","url","_session","createCDPSession","_targetManager","_getTargetInfo","resolve","client","Page_js_1","_create","worker","WebWorker_js_1","browser","openerId","_targets","get","_targetInfoChanged","exports"],"sources":["../../../../src/common/Target.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}