{"ast":null,"code":"/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _IsolatedWorld_instances, _a, _IsolatedWorld_frame, _IsolatedWorld_document, _IsolatedWorld_context, _IsolatedWorld_detached, _IsolatedWorld_ctxBindings, _IsolatedWorld_boundFunctions, _IsolatedWorld_taskManager, _IsolatedWorld_puppeteerUtil, _IsolatedWorld_bindingIdentifier, _IsolatedWorld_client_get, _IsolatedWorld_frameManager_get, _IsolatedWorld_timeoutSettings_get, _IsolatedWorld_injectPuppeteerUtil, _IsolatedWorld_settingUpBinding, _IsolatedWorld_onBindingCalled;\nimport { source as injectedSource } from '../generated/injected.js';\nimport { assert } from '../util/assert.js';\nimport { createDeferredPromise } from '../util/DeferredPromise.js';\nimport { isErrorLike } from '../util/ErrorLike.js';\nimport { LazyArg } from './LazyArg.js';\nimport { LifecycleWatcher } from './LifecycleWatcher.js';\nimport { createJSHandle, debugError, pageBindingInitString } from './util.js';\nimport { TaskManager, WaitTask } from './WaitTask.js';\n/**\n * A unique key for {@link IsolatedWorldChart} to denote the default world.\n * Execution contexts are automatically created in the default world.\n *\n * @internal\n */\nexport const MAIN_WORLD = Symbol('mainWorld');\n/**\n * A unique key for {@link IsolatedWorldChart} to denote the puppeteer world.\n * This world contains all puppeteer-internal bindings/code.\n *\n * @internal\n */\nexport const PUPPETEER_WORLD = Symbol('puppeteerWorld');\n/**\n * @internal\n */\nexport class IsolatedWorld {\n  constructor(frame) {\n    _IsolatedWorld_instances.add(this);\n    _IsolatedWorld_frame.set(this, void 0);\n    _IsolatedWorld_document.set(this, void 0);\n    _IsolatedWorld_context.set(this, createDeferredPromise());\n    _IsolatedWorld_detached.set(this, false);\n    // Set of bindings that have been registered in the current context.\n    _IsolatedWorld_ctxBindings.set(this, new Set());\n    // Contains mapping from functions that should be bound to Puppeteer functions.\n    _IsolatedWorld_boundFunctions.set(this, new Map());\n    _IsolatedWorld_taskManager.set(this, new TaskManager());\n    _IsolatedWorld_puppeteerUtil.set(this, createDeferredPromise());\n    // If multiple waitFor are set up asynchronously, we need to wait for the\n    // first one to set up the binding in the page before running the others.\n    _IsolatedWorld_settingUpBinding.set(this, null);\n    _IsolatedWorld_onBindingCalled.set(this, async event => {\n      let payload;\n      if (!this.hasContext()) {\n        return;\n      }\n      const context = await this.executionContext();\n      try {\n        payload = JSON.parse(event.payload);\n      } catch {\n        // The binding was either called by something in the page or it was\n        // called before our wrapper was initialized.\n        return;\n      }\n      const {\n        type,\n        name,\n        seq,\n        args\n      } = payload;\n      if (type !== 'internal' || !__classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").has(__classPrivateFieldGet(IsolatedWorld, _a, \"f\", _IsolatedWorld_bindingIdentifier).call(IsolatedWorld, name, context._contextId))) {\n        return;\n      }\n      if (context._contextId !== event.executionContextId) {\n        return;\n      }\n      try {\n        const fn = this._boundFunctions.get(name);\n        if (!fn) {\n          throw new Error(`Bound function $name is not found`);\n        }\n        const result = await fn(...args);\n        await context.evaluate((name, seq, result) => {\n          // @ts-expect-error Code is evaluated in a different context.\n          const callbacks = self[name].callbacks;\n          callbacks.get(seq).resolve(result);\n          callbacks.delete(seq);\n        }, name, seq, result);\n      } catch (error) {\n        // The WaitTask may already have been resolved by timing out, or the\n        // exection context may have been destroyed.\n        // In both caes, the promises above are rejected with a protocol error.\n        // We can safely ignores these, as the WaitTask is re-installed in\n        // the next execution context if needed.\n        if (error.message.includes('Protocol error')) {\n          return;\n        }\n        debugError(error);\n      }\n    });\n    // Keep own reference to client because it might differ from the FrameManager's\n    // client for OOP iframes.\n    __classPrivateFieldSet(this, _IsolatedWorld_frame, frame, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).on('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n  }\n  get puppeteerUtil() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_puppeteerUtil, \"f\");\n  }\n  get taskManager() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\");\n  }\n  get _boundFunctions() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_boundFunctions, \"f\");\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\");\n  }\n  clearContext() {\n    __classPrivateFieldSet(this, _IsolatedWorld_document, undefined, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_puppeteerUtil, createDeferredPromise(), \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_context, createDeferredPromise(), \"f\");\n  }\n  setContext(context) {\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"m\", _IsolatedWorld_injectPuppeteerUtil).call(this, context);\n    __classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").clear();\n    __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolve(context);\n  }\n  hasContext() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolved();\n  }\n  _detach() {\n    __classPrivateFieldSet(this, _IsolatedWorld_detached, true, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).off('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").terminateAll(new Error('waitForFunction failed: frame got detached.'));\n  }\n  executionContext() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_detached, \"f\")) {\n      throw new Error(`Execution context is not available in detached frame \"${__classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\").url()}\" (are you trying to evaluate?)`);\n    }\n    if (__classPrivateFieldGet(this, _IsolatedWorld_context, \"f\") === null) {\n      throw new Error(`Execution content promise is missing`);\n    }\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n  }\n  async evaluateHandle(pageFunction) {\n    const context = await this.executionContext();\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n  async evaluate(pageFunction) {\n    const context = await this.executionContext();\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n    return context.evaluate(pageFunction, ...args);\n  }\n  async $(selector) {\n    const document = await this.document();\n    return document.$(selector);\n  }\n  async $$(selector) {\n    const document = await this.document();\n    return document.$$(selector);\n  }\n  async document() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_document, \"f\")) {\n      return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n    }\n    const context = await this.executionContext();\n    __classPrivateFieldSet(this, _IsolatedWorld_document, await context.evaluateHandle(() => {\n      return document;\n    }), \"f\");\n    return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n  }\n  async $x(expression) {\n    const document = await this.document();\n    return document.$x(expression);\n  }\n  async $eval(selector, pageFunction) {\n    const document = await this.document();\n    for (var _len3 = arguments.length, args = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n      args[_key3 - 2] = arguments[_key3];\n    }\n    return document.$eval(selector, pageFunction, ...args);\n  }\n  async $$eval(selector, pageFunction) {\n    const document = await this.document();\n    for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n      args[_key4 - 2] = arguments[_key4];\n    }\n    return document.$$eval(selector, pageFunction, ...args);\n  }\n  async content() {\n    return await this.evaluate(() => {\n      let retVal = '';\n      if (document.doctype) {\n        retVal = new XMLSerializer().serializeToString(document.doctype);\n      }\n      if (document.documentElement) {\n        retVal += document.documentElement.outerHTML;\n      }\n      return retVal;\n    });\n  }\n  async setContent(html) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      waitUntil = ['load'],\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).navigationTimeout()\n    } = options;\n    // We rely upon the fact that document.open() will reset frame lifecycle with \"init\"\n    // lifecycle event. @see https://crrev.com/608658\n    await this.evaluate(html => {\n      document.open();\n      document.write(html);\n      document.close();\n    }, html);\n    const watcher = new LifecycleWatcher(__classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get), __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\"), waitUntil, timeout);\n    const error = await Promise.race([watcher.timeoutOrTerminationPromise(), watcher.lifecyclePromise()]);\n    watcher.dispose();\n    if (error) {\n      throw error;\n    }\n  }\n  async click(selector, options) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.click(options);\n    await handle.dispose();\n  }\n  async focus(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.focus();\n    await handle.dispose();\n  }\n  async hover(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.hover();\n    await handle.dispose();\n  }\n  async select(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    for (var _len5 = arguments.length, values = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      values[_key5 - 1] = arguments[_key5];\n    }\n    const result = await handle.select(...values);\n    await handle.dispose();\n    return result;\n  }\n  async tap(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.tap();\n    await handle.dispose();\n  }\n  async type(selector, text, options) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.type(text, options);\n    await handle.dispose();\n  }\n  async _addBindingToContext(context, name) {\n    // Previous operation added the binding so we are done.\n    if (__classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").has(__classPrivateFieldGet(IsolatedWorld, _a, \"f\", _IsolatedWorld_bindingIdentifier).call(IsolatedWorld, name, context._contextId))) {\n      return;\n    }\n    // Wait for other operation to finish\n    if (__classPrivateFieldGet(this, _IsolatedWorld_settingUpBinding, \"f\")) {\n      await __classPrivateFieldGet(this, _IsolatedWorld_settingUpBinding, \"f\");\n      return this._addBindingToContext(context, name);\n    }\n    const bind = async name => {\n      const expression = pageBindingInitString('internal', name);\n      try {\n        // TODO: In theory, it would be enough to call this just once\n        await context._client.send('Runtime.addBinding', {\n          name,\n          executionContextName: context._contextName\n        });\n        await context.evaluate(expression);\n      } catch (error) {\n        // We could have tried to evaluate in a context which was already\n        // destroyed. This happens, for example, if the page is navigated while\n        // we are trying to add the binding\n        if (error instanceof Error) {\n          // Destroyed context.\n          if (error.message.includes('Execution context was destroyed')) {\n            return;\n          }\n          // Missing context.\n          if (error.message.includes('Cannot find context with specified id')) {\n            return;\n          }\n        }\n        debugError(error);\n        return;\n      }\n      __classPrivateFieldGet(this, _IsolatedWorld_ctxBindings, \"f\").add(__classPrivateFieldGet(IsolatedWorld, _a, \"f\", _IsolatedWorld_bindingIdentifier).call(IsolatedWorld, name, context._contextId));\n    };\n    __classPrivateFieldSet(this, _IsolatedWorld_settingUpBinding, bind(name), \"f\");\n    await __classPrivateFieldGet(this, _IsolatedWorld_settingUpBinding, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_settingUpBinding, null, \"f\");\n  }\n  async _waitForSelectorInPage(queryOne, root, selector, options) {\n    let bindings = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : new Map();\n    const {\n      visible: waitForVisible = false,\n      hidden: waitForHidden = false,\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout()\n    } = options;\n    try {\n      const handle = await this.waitForFunction(async (PuppeteerUtil, query, selector, root, visible) => {\n        if (!PuppeteerUtil) {\n          return;\n        }\n        const node = await PuppeteerUtil.createFunction(query)(root || document, selector, PuppeteerUtil);\n        return PuppeteerUtil.checkVisibility(node, visible);\n      }, {\n        bindings,\n        polling: waitForVisible || waitForHidden ? 'raf' : 'mutation',\n        root,\n        timeout\n      }, new LazyArg(async () => {\n        try {\n          // In case CDP fails.\n          return await this.puppeteerUtil;\n        } catch {\n          return undefined;\n        }\n      }), queryOne.toString(), selector, root, waitForVisible ? true : waitForHidden ? false : undefined);\n      const elementHandle = handle.asElement();\n      if (!elementHandle) {\n        await handle.dispose();\n        return null;\n      }\n      return elementHandle;\n    } catch (error) {\n      if (!isErrorLike(error)) {\n        throw error;\n      }\n      error.message = `Waiting for selector \\`${selector}\\` failed: ${error.message}`;\n      throw error;\n    }\n  }\n  waitForFunction(pageFunction) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      polling = 'raf',\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout(),\n      bindings,\n      root\n    } = options;\n    if (typeof polling === 'number' && polling < 0) {\n      throw new Error('Cannot poll with non-positive interval');\n    }\n    for (var _len6 = arguments.length, args = new Array(_len6 > 2 ? _len6 - 2 : 0), _key6 = 2; _key6 < _len6; _key6++) {\n      args[_key6 - 2] = arguments[_key6];\n    }\n    const waitTask = new WaitTask(this, {\n      bindings,\n      polling,\n      root,\n      timeout\n    }, pageFunction, ...args);\n    return waitTask.result;\n  }\n  async title() {\n    return this.evaluate(() => {\n      return document.title;\n    });\n  }\n  async adoptBackendNode(backendNodeId) {\n    const executionContext = await this.executionContext();\n    const {\n      object\n    } = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.resolveNode', {\n      backendNodeId: backendNodeId,\n      executionContextId: executionContext._contextId\n    });\n    return createJSHandle(executionContext, object);\n  }\n  async adoptHandle(handle) {\n    const executionContext = await this.executionContext();\n    assert(handle.executionContext() !== executionContext, 'Cannot adopt handle that already belongs to this execution context');\n    const nodeInfo = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.remoteObject().objectId\n    });\n    return await this.adoptBackendNode(nodeInfo.node.backendNodeId);\n  }\n  async transferHandle(handle) {\n    const result = await this.adoptHandle(handle);\n    await handle.dispose();\n    return result;\n  }\n}\n_a = IsolatedWorld, _IsolatedWorld_frame = new WeakMap(), _IsolatedWorld_document = new WeakMap(), _IsolatedWorld_context = new WeakMap(), _IsolatedWorld_detached = new WeakMap(), _IsolatedWorld_ctxBindings = new WeakMap(), _IsolatedWorld_boundFunctions = new WeakMap(), _IsolatedWorld_taskManager = new WeakMap(), _IsolatedWorld_puppeteerUtil = new WeakMap(), _IsolatedWorld_settingUpBinding = new WeakMap(), _IsolatedWorld_onBindingCalled = new WeakMap(), _IsolatedWorld_instances = new WeakSet(), _IsolatedWorld_client_get = function _IsolatedWorld_client_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._client();\n}, _IsolatedWorld_frameManager_get = function _IsolatedWorld_frameManager_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._frameManager;\n}, _IsolatedWorld_timeoutSettings_get = function _IsolatedWorld_timeoutSettings_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get).timeoutSettings;\n}, _IsolatedWorld_injectPuppeteerUtil = async function _IsolatedWorld_injectPuppeteerUtil(context) {\n  try {\n    __classPrivateFieldGet(this, _IsolatedWorld_puppeteerUtil, \"f\").resolve(await context.evaluateHandle(`(() => {\n              const module = {};\n              ${injectedSource}\n              return module.exports.default;\n            })()`));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").rerunAll();\n  } catch (error) {\n    debugError(error);\n  }\n};\n_IsolatedWorld_bindingIdentifier = {\n  value: (name, contextId) => {\n    return `${name}_${contextId}`;\n  }\n};","map":{"version":3,"mappings":"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","names":["source","injectedSource","assert","createDeferredPromise","isErrorLike","LazyArg","LifecycleWatcher","createJSHandle","debugError","pageBindingInitString","TaskManager","WaitTask","MAIN_WORLD","Symbol","PUPPETEER_WORLD","IsolatedWorld","constructor","frame","_IsolatedWorld_frame","_IsolatedWorld_document","_IsolatedWorld_context","_IsolatedWorld_detached","_IsolatedWorld_ctxBindings","Set","_IsolatedWorld_boundFunctions","Map","_IsolatedWorld_taskManager","_IsolatedWorld_puppeteerUtil","_IsolatedWorld_settingUpBinding","_IsolatedWorld_onBindingCalled","event","payload","hasContext","context","executionContext","JSON","parse","type","name","seq","args","__classPrivateFieldGet","has","_contextId","executionContextId","fn","_boundFunctions","get","Error","result","evaluate","callbacks","self","resolve","delete","error","message","includes","__classPrivateFieldSet","on","puppeteerUtil","taskManager","clearContext","undefined","setContext","clear","resolved","_detach","off","terminateAll","url","evaluateHandle","pageFunction","$","selector","document","$$","$x","expression","$eval","$$eval","content","retVal","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","options","waitUntil","timeout","navigationTimeout","open","write","close","watcher","Promise","race","timeoutOrTerminationPromise","lifecyclePromise","dispose","click","handle","focus","hover","select","values","tap","text","_addBindingToContext","bind","_client","send","executionContextName","_contextName","add","_waitForSelectorInPage","queryOne","root","bindings","visible","waitForVisible","hidden","waitForHidden","waitForFunction","PuppeteerUtil","query","node","createFunction","checkVisibility","polling","toString","elementHandle","asElement","waitTask","title","adoptBackendNode","backendNodeId","object","adoptHandle","nodeInfo","objectId","remoteObject","transferHandle","_frameManager","timeoutSettings","_IsolatedWorld_injectPuppeteerUtil","rerunAll","_IsolatedWorld_bindingIdentifier","value","contextId"],"sources":["../../../../src/common/IsolatedWorld.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}