{"ast":null,"code":"import fs from 'fs';\nimport os from 'os';\nimport path from 'path';\nimport { Browser as BiDiBrowser } from '../common/bidi/Browser.js';\nimport { CDPBrowser } from '../common/Browser.js';\nimport { assert } from '../util/assert.js';\nimport { BrowserFetcher } from './BrowserFetcher.js';\nimport { BrowserRunner } from './BrowserRunner.js';\nimport { resolveExecutablePath } from './ProductLauncher.js';\nimport { tmpdir } from './util.js';\n/**\n * @internal\n */\nexport class FirefoxLauncher {\n  constructor(preferredRevision, isPuppeteerCore) {\n    this._preferredRevision = preferredRevision;\n    this._isPuppeteerCore = isPuppeteerCore;\n  }\n  async launch() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      ignoreDefaultArgs = false,\n      args = [],\n      dumpio = false,\n      executablePath = null,\n      pipe = false,\n      env = process.env,\n      handleSIGINT = true,\n      handleSIGTERM = true,\n      handleSIGHUP = true,\n      ignoreHTTPSErrors = false,\n      defaultViewport = {\n        width: 800,\n        height: 600\n      },\n      slowMo = 0,\n      timeout = 30000,\n      extraPrefsFirefox = {},\n      waitForInitialPage = true,\n      debuggingPort = null,\n      protocol = 'cdp'\n    } = options;\n    const firefoxArguments = [];\n    if (!ignoreDefaultArgs) {\n      firefoxArguments.push(...this.defaultArgs(options));\n    } else if (Array.isArray(ignoreDefaultArgs)) {\n      firefoxArguments.push(...this.defaultArgs(options).filter(arg => {\n        return !ignoreDefaultArgs.includes(arg);\n      }));\n    } else {\n      firefoxArguments.push(...args);\n    }\n    if (!firefoxArguments.some(argument => {\n      return argument.startsWith('--remote-debugging-');\n    })) {\n      if (pipe) {\n        assert(debuggingPort === null, 'Browser should be launched with either pipe or debugging port - not both.');\n      }\n      firefoxArguments.push(`--remote-debugging-port=${debuggingPort || 0}`);\n    }\n    let userDataDir;\n    let isTempUserDataDir = true;\n    // Check for the profile argument, which will always be set even\n    // with a custom directory specified via the userDataDir option.\n    const profileArgIndex = firefoxArguments.findIndex(arg => {\n      return ['-profile', '--profile'].includes(arg);\n    });\n    if (profileArgIndex !== -1) {\n      userDataDir = firefoxArguments[profileArgIndex + 1];\n      if (!userDataDir || !fs.existsSync(userDataDir)) {\n        throw new Error(`Firefox profile not found at '${userDataDir}'`);\n      }\n      // When using a custom Firefox profile it needs to be populated\n      // with required preferences.\n      isTempUserDataDir = false;\n      const prefs = this.defaultPreferences(extraPrefsFirefox);\n      this.writePreferences(prefs, userDataDir);\n    } else {\n      userDataDir = await this._createProfile(extraPrefsFirefox);\n      firefoxArguments.push('--profile');\n      firefoxArguments.push(userDataDir);\n    }\n    if (!this._isPuppeteerCore) {\n      await this._updateRevision();\n    }\n    let firefoxExecutable = executablePath;\n    if (!executablePath) {\n      const {\n        missingText,\n        executablePath\n      } = resolveExecutablePath(this);\n      if (missingText) {\n        throw new Error(missingText);\n      }\n      firefoxExecutable = executablePath;\n    }\n    if (!firefoxExecutable) {\n      throw new Error('firefoxExecutable is not found.');\n    }\n    const runner = new BrowserRunner(this.product, firefoxExecutable, firefoxArguments, userDataDir, isTempUserDataDir);\n    runner.start({\n      handleSIGHUP,\n      handleSIGTERM,\n      handleSIGINT,\n      dumpio,\n      env,\n      pipe\n    });\n    if (protocol === 'webDriverBiDi') {\n      let browser;\n      try {\n        const connection = await runner.setupWebDriverBiDiConnection({\n          timeout,\n          slowMo,\n          preferredRevision: this._preferredRevision\n        });\n        browser = await BiDiBrowser.create({\n          connection,\n          closeCallback: runner.close.bind(runner),\n          process: runner.proc\n        });\n      } catch (error) {\n        runner.kill();\n        throw error;\n      }\n      return browser;\n    }\n    let browser;\n    try {\n      const connection = await runner.setupConnection({\n        usePipe: pipe,\n        timeout,\n        slowMo,\n        preferredRevision: this._preferredRevision\n      });\n      browser = await CDPBrowser._create(this.product, connection, [], ignoreHTTPSErrors, defaultViewport, runner.proc, runner.close.bind(runner), options.targetFilter);\n    } catch (error) {\n      runner.kill();\n      throw error;\n    }\n    if (waitForInitialPage) {\n      try {\n        await browser.waitForTarget(t => {\n          return t.type() === 'page';\n        }, {\n          timeout\n        });\n      } catch (error) {\n        await browser.close();\n        throw error;\n      }\n    }\n    return browser;\n  }\n  executablePath() {\n    return resolveExecutablePath(this).executablePath;\n  }\n  async _updateRevision() {\n    // replace 'latest' placeholder with actual downloaded revision\n    if (this._preferredRevision === 'latest') {\n      const browserFetcher = new BrowserFetcher({\n        product: this.product\n      });\n      const localRevisions = await browserFetcher.localRevisions();\n      if (localRevisions[0]) {\n        this._preferredRevision = localRevisions[0];\n      }\n    }\n  }\n  get product() {\n    return 'firefox';\n  }\n  defaultArgs() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      devtools = false,\n      headless = !devtools,\n      args = [],\n      userDataDir = null\n    } = options;\n    const firefoxArguments = ['--no-remote'];\n    switch (os.platform()) {\n      case 'darwin':\n        firefoxArguments.push('--foreground');\n        break;\n      case 'win32':\n        firefoxArguments.push('--wait-for-browser');\n        break;\n    }\n    if (userDataDir) {\n      firefoxArguments.push('--profile');\n      firefoxArguments.push(userDataDir);\n    }\n    if (headless) {\n      firefoxArguments.push('--headless');\n    }\n    if (devtools) {\n      firefoxArguments.push('--devtools');\n    }\n    if (args.every(arg => {\n      return arg.startsWith('-');\n    })) {\n      firefoxArguments.push('about:blank');\n    }\n    firefoxArguments.push(...args);\n    return firefoxArguments;\n  }\n  defaultPreferences(extraPrefs) {\n    const server = 'dummy.test';\n    const defaultPrefs = {\n      // Make sure Shield doesn't hit the network.\n      'app.normandy.api_url': '',\n      // Disable Firefox old build background check\n      'app.update.checkInstallTime': false,\n      // Disable automatically upgrading Firefox\n      'app.update.disabledForTesting': true,\n      // Increase the APZ content response timeout to 1 minute\n      'apz.content_response_timeout': 60000,\n      // Prevent various error message on the console\n      // jest-puppeteer asserts that no error message is emitted by the console\n      'browser.contentblocking.features.standard': '-tp,tpPrivate,cookieBehavior0,-cm,-fp',\n      // Enable the dump function: which sends messages to the system\n      // console\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=1543115\n      'browser.dom.window.dump.enabled': true,\n      // Disable topstories\n      'browser.newtabpage.activity-stream.feeds.system.topstories': false,\n      // Always display a blank page\n      'browser.newtabpage.enabled': false,\n      // Background thumbnails in particular cause grief: and disabling\n      // thumbnails in general cannot hurt\n      'browser.pagethumbnails.capturing_disabled': true,\n      // Disable safebrowsing components.\n      'browser.safebrowsing.blockedURIs.enabled': false,\n      'browser.safebrowsing.downloads.enabled': false,\n      'browser.safebrowsing.malware.enabled': false,\n      'browser.safebrowsing.passwords.enabled': false,\n      'browser.safebrowsing.phishing.enabled': false,\n      // Disable updates to search engines.\n      'browser.search.update': false,\n      // Do not restore the last open set of tabs if the browser has crashed\n      'browser.sessionstore.resume_from_crash': false,\n      // Skip check for default browser on startup\n      'browser.shell.checkDefaultBrowser': false,\n      // Disable newtabpage\n      'browser.startup.homepage': 'about:blank',\n      // Do not redirect user when a milstone upgrade of Firefox is detected\n      'browser.startup.homepage_override.mstone': 'ignore',\n      // Start with a blank page about:blank\n      'browser.startup.page': 0,\n      // Do not allow background tabs to be zombified on Android: otherwise for\n      // tests that open additional tabs: the test harness tab itself might get\n      // unloaded\n      'browser.tabs.disableBackgroundZombification': false,\n      // Do not warn when closing all other open tabs\n      'browser.tabs.warnOnCloseOtherTabs': false,\n      // Do not warn when multiple tabs will be opened\n      'browser.tabs.warnOnOpen': false,\n      // Disable the UI tour.\n      'browser.uitour.enabled': false,\n      // Turn off search suggestions in the location bar so as not to trigger\n      // network connections.\n      'browser.urlbar.suggest.searches': false,\n      // Disable first run splash page on Windows 10\n      'browser.usedOnWindows10.introURL': '',\n      // Do not warn on quitting Firefox\n      'browser.warnOnQuit': false,\n      // Defensively disable data reporting systems\n      'datareporting.healthreport.documentServerURI': `http://${server}/dummy/healthreport/`,\n      'datareporting.healthreport.logging.consoleEnabled': false,\n      'datareporting.healthreport.service.enabled': false,\n      'datareporting.healthreport.service.firstRun': false,\n      'datareporting.healthreport.uploadEnabled': false,\n      // Do not show datareporting policy notifications which can interfere with tests\n      'datareporting.policy.dataSubmissionEnabled': false,\n      'datareporting.policy.dataSubmissionPolicyBypassNotification': true,\n      // DevTools JSONViewer sometimes fails to load dependencies with its require.js.\n      // This doesn't affect Puppeteer but spams console (Bug 1424372)\n      'devtools.jsonview.enabled': false,\n      // Disable popup-blocker\n      'dom.disable_open_during_load': false,\n      // Enable the support for File object creation in the content process\n      // Required for |Page.setFileInputFiles| protocol method.\n      'dom.file.createInChild': true,\n      // Disable the ProcessHangMonitor\n      'dom.ipc.reportProcessHangs': false,\n      // Disable slow script dialogues\n      'dom.max_chrome_script_run_time': 0,\n      'dom.max_script_run_time': 0,\n      // Only load extensions from the application and user profile\n      // AddonManager.SCOPE_PROFILE + AddonManager.SCOPE_APPLICATION\n      'extensions.autoDisableScopes': 0,\n      'extensions.enabledScopes': 5,\n      // Disable metadata caching for installed add-ons by default\n      'extensions.getAddons.cache.enabled': false,\n      // Disable installing any distribution extensions or add-ons.\n      'extensions.installDistroAddons': false,\n      // Disabled screenshots extension\n      'extensions.screenshots.disabled': true,\n      // Turn off extension updates so they do not bother tests\n      'extensions.update.enabled': false,\n      // Turn off extension updates so they do not bother tests\n      'extensions.update.notifyUser': false,\n      // Make sure opening about:addons will not hit the network\n      'extensions.webservice.discoverURL': `http://${server}/dummy/discoveryURL`,\n      // Temporarily force disable BFCache in parent (https://bit.ly/bug-1732263)\n      'fission.bfcacheInParent': false,\n      // Force all web content to use a single content process\n      'fission.webContentIsolationStrategy': 0,\n      // Allow the application to have focus even it runs in the background\n      'focusmanager.testmode': true,\n      // Disable useragent updates\n      'general.useragent.updates.enabled': false,\n      // Always use network provider for geolocation tests so we bypass the\n      // macOS dialog raised by the corelocation provider\n      'geo.provider.testing': true,\n      // Do not scan Wifi\n      'geo.wifi.scan': false,\n      // No hang monitor\n      'hangmonitor.timeout': 0,\n      // Show chrome errors and warnings in the error console\n      'javascript.options.showInConsole': true,\n      // Disable download and usage of OpenH264: and Widevine plugins\n      'media.gmp-manager.updateEnabled': false,\n      // Prevent various error message on the console\n      // jest-puppeteer asserts that no error message is emitted by the console\n      'network.cookie.cookieBehavior': 0,\n      // Disable experimental feature that is only available in Nightly\n      'network.cookie.sameSite.laxByDefault': false,\n      // Do not prompt for temporary redirects\n      'network.http.prompt-temp-redirect': false,\n      // Disable speculative connections so they are not reported as leaking\n      // when they are hanging around\n      'network.http.speculative-parallel-limit': 0,\n      // Do not automatically switch between offline and online\n      'network.manage-offline-status': false,\n      // Make sure SNTP requests do not hit the network\n      'network.sntp.pools': server,\n      // Disable Flash.\n      'plugin.state.flash': 0,\n      'privacy.trackingprotection.enabled': false,\n      // Can be removed once Firefox 89 is no longer supported\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=1710839\n      'remote.enabled': true,\n      // Don't do network connections for mitm priming\n      'security.certerrors.mitm.priming.enabled': false,\n      // Local documents have access to all other local documents,\n      // including directory listings\n      'security.fileuri.strict_origin_policy': false,\n      // Do not wait for the notification button security delay\n      'security.notification_enable_delay': 0,\n      // Ensure blocklist updates do not hit the network\n      'services.settings.server': `http://${server}/dummy/blocklist/`,\n      // Do not automatically fill sign-in forms with known usernames and\n      // passwords\n      'signon.autofillForms': false,\n      // Disable password capture, so that tests that include forms are not\n      // influenced by the presence of the persistent doorhanger notification\n      'signon.rememberSignons': false,\n      // Disable first-run welcome page\n      'startup.homepage_welcome_url': 'about:blank',\n      // Disable first-run welcome page\n      'startup.homepage_welcome_url.additional': '',\n      // Disable browser animations (tabs, fullscreen, sliding alerts)\n      'toolkit.cosmeticAnimations.enabled': false,\n      // Prevent starting into safe mode after application crashes\n      'toolkit.startup.max_resumed_crashes': -1\n    };\n    return Object.assign(defaultPrefs, extraPrefs);\n  }\n  /**\n   * Populates the user.js file with custom preferences as needed to allow\n   * Firefox's CDP support to properly function. These preferences will be\n   * automatically copied over to prefs.js during startup of Firefox. To be\n   * able to restore the original values of preferences a backup of prefs.js\n   * will be created.\n   *\n   * @param prefs - List of preferences to add.\n   * @param profilePath - Firefox profile to write the preferences to.\n   */\n  async writePreferences(prefs, profilePath) {\n    const lines = Object.entries(prefs).map(_ref => {\n      let [key, value] = _ref;\n      return `user_pref(${JSON.stringify(key)}, ${JSON.stringify(value)});`;\n    });\n    await fs.promises.writeFile(path.join(profilePath, 'user.js'), lines.join('\\n'));\n    // Create a backup of the preferences file if it already exitsts.\n    const prefsPath = path.join(profilePath, 'prefs.js');\n    if (fs.existsSync(prefsPath)) {\n      const prefsBackupPath = path.join(profilePath, 'prefs.js.puppeteer');\n      await fs.promises.copyFile(prefsPath, prefsBackupPath);\n    }\n  }\n  async _createProfile(extraPrefs) {\n    const temporaryProfilePath = await fs.promises.mkdtemp(path.join(tmpdir(), 'puppeteer_dev_firefox_profile-'));\n    const prefs = this.defaultPreferences(extraPrefs);\n    await this.writePreferences(prefs, temporaryProfilePath);\n    return temporaryProfilePath;\n  }\n}","map":{"version":3,"mappings":"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","names":["fs","os","path","Browser","BiDiBrowser","CDPBrowser","assert","BrowserFetcher","BrowserRunner","resolveExecutablePath","tmpdir","FirefoxLauncher","constructor","preferredRevision","isPuppeteerCore","_preferredRevision","_isPuppeteerCore","launch","options","ignoreDefaultArgs","args","dumpio","executablePath","pipe","env","process","handleSIGINT","handleSIGTERM","handleSIGHUP","ignoreHTTPSErrors","defaultViewport","width","height","slowMo","timeout","extraPrefsFirefox","waitForInitialPage","debuggingPort","protocol","firefoxArguments","push","defaultArgs","Array","isArray","filter","arg","includes","some","argument","startsWith","userDataDir","isTempUserDataDir","profileArgIndex","findIndex","existsSync","Error","prefs","defaultPreferences","writePreferences","_createProfile","_updateRevision","firefoxExecutable","missingText","runner","product","start","browser","connection","setupWebDriverBiDiConnection","create","closeCallback","close","bind","proc","error","kill","setupConnection","usePipe","_create","targetFilter","waitForTarget","t","type","browserFetcher","localRevisions","devtools","headless","platform","every","extraPrefs","server","defaultPrefs","Object","assign","profilePath","lines","entries","map","key","value","JSON","stringify","promises","writeFile","join","prefsPath","prefsBackupPath","copyFile","temporaryProfilePath","mkdtemp"],"sources":["../../../../src/node/FirefoxLauncher.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}